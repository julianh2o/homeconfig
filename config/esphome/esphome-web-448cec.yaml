substitutions: # Modify these to fit your needs
  font_directory: /config/esphome/fonts/
  width: 320
  height: 240
  device_name: esp32-cyd-448cec
  nice_name: Control Panel 1

# ESPHome naming
esphome:
  name: ${device_name} # Device hostname
  friendly_name: ${nice_name} # Friendly name shown in Home Assistant

# The ESP32-2432S028 uses a standard ESP32-WROVER, so we use esp32dev
esp32:
  board: esp32dev
  framework:
    type: arduino

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: !secret ha_encryption_key

# Set OTA password, enables updates via ESPHome
ota:
  platform: esphome
  password: !secret ota_password

# Setup WiFi credentials, references the wifi ssid and pass in secrets.yaml
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot in case wifi connection fails
  ap:
    ssid: $device_name
    password: !secret ap_password

# Allows captive portal access when in fallback mode
captive_portal:

# ============================================================
# ESPHome Display related setup
# ============================================================
# Create a font to use, add and remove glyphs as needed.
font:
  - file:
      path: ${font_directory}Arimo-Regular.ttf # Path to main font file
      type: local
    id: arimo32 # ID used to reference this font
    size: 32 # Font size
    glyphs: # Characters to include in font. Only
      - " .,°0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ" # add characters you need to reduce memory usage.
  - file: # Giving an ID for a larger size of that font.
      path: ${font_directory}Arimo-Regular.ttf
      type: local
    id: arimo14
    size: 14
    glyphs:
      - " .,°0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"
  - file: ${font_directory}materialdesignicons-webfont.ttf # Defining Material Design Icons as a font. This
    id: mdi_icons # will allow us to use them as button icons.
    size: 48 # You can get these glyphs from the https://pictogrammers.com/library/mdi/
    glyphs: # where you choose the icon, and then "copy glyph".
      - "\U000f06e8" # mdi-lightbulb-on
      - "\U000F0E4F" # mdi-lightbulb-off
      - "\U000f1a4c" # mdi-lightbulb-night
      - "\U000F1A52" # mdi-lightbulb-on-50

color:
  - id: room_bg_color
    hex: "000000"
  - id: default_button_bg_color
    hex: "000000"
  - id: default_button_pressed_bg_color
    hex: "D3D3D3"
  - id: btn_1_color
    hex: FF0000 # Red
  - id: btn_2_color
    hex: FF7F00 # Orange
  - id: btn_3_color
    hex: FFFF00 # Yellow
  - id: btn_4_color
    hex: 00FF00 # Green
  - id: btn_5_color
    hex: FF1493 # Pink
  - id: btn_6_color
    hex: "800080" # Purple
  - id: btn_7_color
    hex: 0000FF # Blue
  - id: btn_8_color
    hex: 00FFFF # Aqua
  - id: btn_9_color
    hex: "FFFFFF" # White
  - id: btn_10_color
    hex: "FFFFFF" # White
  - id: btn_11_color
    hex: "FFFFFF" # White
  - id: btn_12_color
    hex: "FFFFFF" # White

# ============================================================
# Home Assistant related setup
# ============================================================

# ==== Lights ====
light:
  # LCD backlight
  - platform: monochromatic
    output: backlight_pwm
    name: "Display Backlight"
    id: backlight
    restore_mode: ALWAYS_ON
  # onboard rgb led
  - platform: rgb
    name: "Front LED"
    id: front_led
    restore_mode: ALWAYS_OFF
    red: led_red
    green: led_green
    blue: led_blue

# ==== Touch Button Sensors for Home Assistant ====
binary_sensor:
  - platform: template
    name: "Scene Off Button"
    id: scene_off_button_pressed
  - platform: template
    name: "Scene Moody Button"
    id: scene_moody_button_pressed
  - platform: template
    name: "Scene Normal Button"
    id: scene_normal_button_pressed
  - platform: template
    name: "Scene Bright Button"
    id: scene_bright_button_pressed

# ============================================================
# Touchscreen Display related setup
# ============================================================

# SPI bus for TFT display and touch controller
spi:
  - id: tft
    clk_pin: GPIO14
    mosi_pin: GPIO13
    # miso_pin: GPIO12
  - id: touch
    clk_pin: GPIO25
    mosi_pin: GPIO32
    miso_pin: GPIO39

# Set a pin to control the backlight
output:
  - platform: ledc
    pin: GPIO21
    id: backlight_pwm
    frequency: 1000 Hz
    inverted: false
  - platform: ledc
    pin: GPIO04
    id: led_red
    inverted: true
  - platform: ledc
    pin: GPIO17
    id: led_blue
    inverted: true
  - platform: ledc
    pin: GPIO16
    id: led_green
    inverted: true

# Tracks if recent touch occurred
globals:
  - id: recent_touch
    type: bool
    restore_value: no
    initial_value: "true"

# Defining the touchscreen for later use
touchscreen:
  platform: xpt2046
  spi_id: touch
  cs_pin: GPIO33
  interrupt_pin: GPIO36
  update_interval: 50ms
  threshold: 400
  calibration:
    x_min: 180
    x_max: 3800
    y_min: 240
    y_max: 3860
  transform:
    swap_xy: true
    # mirror_x: true  # If you need to swap bottom to top for touch, uncomment this so it registers correctly
  on_touch:
    then:
      - light.turn_on: backlight
      - lambda: |-
          id(recent_touch) = true;

# Defining the display type and properties, and defining the buttons displayed.
display:
  - platform: ili9xxx
    color_palette: 8BIT # Lower memory usage
    model: ST7789V # Display driver model
    spi_id: tft
    cs_pin:
      number: GPIO15
      ignore_strapping_warning: true
    dc_pin:
      number: GPIO2
      ignore_strapping_warning: true
    invert_colors: false
    transform:
      swap_xy: true # Orient screen properly
      mirror_x: true # if your top row is on the bottom, comment this line out or swtich to false
    dimensions:
      width: ${width}
      height: ${height}

# Defining the buttons displayed
lvgl:
  buffer_size: 25%
  theme:
    label:
      text_color: 0xFFFFFF
    button:
      bg_color: 0x2D2D2D
      bg_opa: COVER
      border_color: 0x000000
      border_width: 0
      text_color: 0xFFFFFF
      pad_left: 30px
      pad_right: 30px
      pad_top: 12px
      pad_bottom: 12px
      pressed:
        bg_color: 0xC0C0C0
        bg_grad_color: 0xC0C0C0
        bg_opa: COVER
      checked:
        bg_color: 0x000000
        bg_grad_color: 0x000000
        bg_opa: COVER
        text_color: 0x800080
  pages:
    - id: main_page
      pad_all: 0
      widgets:
        - obj:
            align: CENTER
            width: 320
            height: 240
            border_width: 0
            border_color: 0x000000
            radius: 0
            pad_all: 6
            bg_color: 0x000000
            layout:
              type: GRID
              grid_columns: [FR(1), FR(1), FR(1), FR(1)]
              grid_rows: [FR(18), FR(40), FR(42)]
              pad_row: 6
              pad_column: 8
            widgets:
              # Title label spanning all columns
              - label:
                  id: lbl_light_control
                  text: "Light Control"
                  text_font: arimo32
                  text_color: 0xFFFFFF
                  align: center
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 0
                  grid_cell_column_span: 4
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              # Button icons row
              - button:
                  id: but_off
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 1
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        id: lbl_icon_off
                        align: CENTER
                        text: "\U000F0E4F" # mdi-lightbulb-off
                        text_font: mdi_icons
                  on_click:
                    then:
                      - binary_sensor.template.publish:
                          id: scene_off_button_pressed
                          state: ON
                      - delay: 500ms
                      - binary_sensor.template.publish:
                          id: scene_off_button_pressed
                          state: OFF
              - button:
                  id: but_moody
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 1
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        id: lbl_icon_moody
                        align: CENTER
                        text: "\U000f1a4c" # mdi-lightbulb-night
                        text_font: mdi_icons
                  on_click:
                    then:
                      - binary_sensor.template.publish:
                          id: scene_moody_button_pressed
                          state: ON
                      - delay: 500ms
                      - binary_sensor.template.publish:
                          id: scene_moody_button_pressed
                          state: OFF
              - button:
                  id: but_normal
                  grid_cell_column_pos: 2
                  grid_cell_row_pos: 1
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        id: lbl_icon_normal
                        align: CENTER
                        text: "\U000f1a52" # mdi-lightbulb-on-50
                        text_font: mdi_icons
                  on_click:
                    then:
                      - binary_sensor.template.publish:
                          id: scene_normal_button_pressed
                          state: ON
                      - delay: 500ms
                      - binary_sensor.template.publish:
                          id: scene_normal_button_pressed
                          state: OFF
              - button:
                  id: but_bright
                  grid_cell_column_pos: 3
                  grid_cell_row_pos: 1
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        id: lbl_icon_bright
                        align: CENTER
                        text: "\U000f06e8" # mdi-lightbulb-on
                        text_font: mdi_icons
                  on_click:
                    then:
                      - binary_sensor.template.publish:
                          id: scene_bright_button_pressed
                          state: ON
                      - delay: 500ms
                      - binary_sensor.template.publish:
                          id: scene_bright_button_pressed
                          state: OFF
              # Button labels row
              - label:
                  id: lbl_off
                  text: "Off"
                  align: center
                  text_align: center
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  id: lbl_moody
                  text: "Moody"
                  align: center
                  text_align: center
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  id: lbl_normal
                  text: "Normal"
                  align: center
                  text_align: center
                  grid_cell_column_pos: 2
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
              - label:
                  id: lbl_bright
                  text: "Bright"
                  align: center
                  text_align: center
                  grid_cell_column_pos: 3
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
